const e={alpineEl:null,livewireComponent:null,storeName:null,store:null,registerStore(e,r){this.ensureStoreMissing(e),this.createStore(e,r),this.findLivewireComponent(),this.livewireComponentNotLoaded()||Object.entries(r).forEach(([e,r])=>{if(this.isNotEntangleObject(r))return;let t=r.livewireEntangle,i=r.isDeferred;this.valuesAreNotEqual(this.getStoreProperty(e),this.getLivewireProperty(t))&&this.setStoreProperty(e,this.getLivewireProperty(t)),this.registerSpruceWatcher(e,t,i),this.registerLivewireWatcher(t,e)})},loadStore(e,r){this.ensureStoreExists(e),this.findStore(e),this.findLivewireComponent(),this.livewireComponentNotLoaded()||Object.entries(r).forEach(([e,r])=>{if(this.isNotEntangleObject(r))return;this.ensureStorePropertyExists(e);let t=r.livewireEntangle,i=r.isDeferred;this.valuesAreNotEqual(this.getStoreProperty(e),this.getLivewireProperty(t))&&this.setLivewireProperty(t,this.getStoreProperty(e),i),this.registerSpruceWatcher(e,t,i),this.registerLivewireWatcher(t,e)})},ensureStoreMissing(e){if(Spruce.store(e))throw new Error('[Sprucewire] Spruce store "'+e+'" is already registered. Use loadStore.')},ensureStoreExists(e){if(!Spruce.store(e))throw new Error('[Sprucewire] Spruce store "'+e+'" is not registered. Use registerStore.')},createStore(e,r){this.store=Spruce.store(e,this.clearEntangleValues(r)),this.storeName=e},clearEntangleValues(e){return Object.keys(e).reduce((r,t)=>(r[t]=this.isEntangleObject(e[t])?null:e[t],r),{})},findStore(e){this.store=Spruce.store(e),this.storeName=e},findLivewireComponent(){let e=this.alpineEl.closest("[wire\\:id]");e&&e.__livewire&&(this.livewireComponent=e.__livewire)},livewireComponentNotLoaded(){return!this.livewireComponent},isEntangleObject:e=>e&&"object"==typeof e&&e.livewireEntangle,isNotEntangleObject(e){return!this.isEntangleObject(e)},ensureStorePropertyExists(e){if(!this.store[e])throw new Error('[Sprucewire] Spruce store "'+this.storeName+'" does not have property "'+e+'".')},getLivewireProperty(e){return this.livewireComponent.getPropertyValueIncludingDefers(e)},getStoreProperty(e){return this.store[e]},setLivewireProperty(e,r,t){this.livewireComponent.set(e,this.cloneValue(r),t)},setStoreProperty(e,r){this.store[e]=this.cloneValue(r)},cloneValue:e=>void 0!==e?JSON.parse(JSON.stringify(e)):e,valuesAreEqual:(e,r)=>JSON.stringify(e)===JSON.stringify(r),valuesAreNotEqual(e,r){return!this.valuesAreEqual(e,r)},registerSpruceWatcher(e,r,t){Spruce.watch(this.storeName+"."+e,e=>{this.valuesAreEqual(e,this.getLivewireProperty(r))||this.setLivewireProperty(r,e,t)})},registerLivewireWatcher(e,r){this.livewireComponent.watch(e,e=>{this.valuesAreEqual(e,this.getStoreProperty(r))||this.setStoreProperty(r,e)})}},r={start(){console.log("start"),this.attach()},attach(){this.checkDependencies(),window.Alpine.addMagicProperty("sprucewire",e=>(console.log("Sprucewire"),this.getElEntangle(e))),window.Alpine.addMagicProperty("entangleProperty",e=>function(e,r=!1){return{isDeferred:r,livewireEntangle:e,get defer(){return this.isDeferred=!0,this}}})},checkDependencies(){if(!window.Alpine)throw new Error("[Sprucewire] Alpine must be running.");if(!window.Spruce)throw new Error("[Sprucewire] Spruce must be running.");return!0},getElEntangle:r=>Object.assign({},e,{alpineEl:r}),registerStore(e,r,t){this.getElEntangle(e).registerStore(r,t)}};window.Sprucewire=r;const t=window.deferLoadingAlpine||function(e){e()};window.deferLoadingAlpine=function(e){window.Sprucewire.start(),t(e)};
//# sourceMappingURL=sprucewire.modern.js.map
