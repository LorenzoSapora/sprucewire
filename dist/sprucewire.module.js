var e={alpineEl:null,livewireComponent:null,storeName:null,store:null,registerStore:function(e,r){var t=this;this.ensureStoreMissing(e),this.createStore(e,r),this.findLivewireComponent(),this.livewireComponentNotLoaded()||Object.entries(r).forEach(function(e){var r=e[0],i=e[1];if(!t.isNotEntangleObject(i)){var n=i.livewireEntangle,o=i.isDeferred;t.valuesAreNotEqual(t.getStoreProperty(r),t.getLivewireProperty(n))&&t.setStoreProperty(r,t.getLivewireProperty(n)),t.registerSpruceWatcher(r,n,o),t.registerLivewireWatcher(n,r)}})},loadStore:function(e,r){var t=this;this.ensureStoreExists(e),this.findStore(e),this.findLivewireComponent(),this.livewireComponentNotLoaded()||Object.entries(r).forEach(function(e){var r=e[0],i=e[1];if(!t.isNotEntangleObject(i)){t.ensureStorePropertyExists(r);var n=i.livewireEntangle,o=i.isDeferred;t.valuesAreNotEqual(t.getStoreProperty(r),t.getLivewireProperty(n))&&t.setLivewireProperty(n,t.getStoreProperty(r),o),t.registerSpruceWatcher(r,n,o),t.registerLivewireWatcher(n,r)}})},ensureStoreMissing:function(e){if(Spruce.store(e))throw new Error('[Sprucewire] Spruce store "'+e+'" is already registered. Use loadStore.')},ensureStoreExists:function(e){if(!Spruce.store(e))throw new Error('[Sprucewire] Spruce store "'+e+'" is not registered. Use registerStore.')},createStore:function(e,r){this.store=Spruce.store(e,this.clearEntangleValues(r)),this.storeName=e},clearEntangleValues:function(e){var r=this;return Object.keys(e).reduce(function(t,i){return t[i]=r.isEntangleObject(e[i])?null:e[i],t},{})},findStore:function(e){this.store=Spruce.store(e),this.storeName=e},findLivewireComponent:function(){var e=this.alpineEl.closest("[wire\\:id]");e&&e.__livewire&&(this.livewireComponent=e.__livewire)},livewireComponentNotLoaded:function(){return!this.livewireComponent},isEntangleObject:function(e){return e&&"object"==typeof e&&e.livewireEntangle},isNotEntangleObject:function(e){return!this.isEntangleObject(e)},ensureStorePropertyExists:function(e){if(!this.store[e])throw new Error('[Sprucewire] Spruce store "'+this.storeName+'" does not have property "'+e+'".')},getLivewireProperty:function(e){return this.livewireComponent.getPropertyValueIncludingDefers(e)},getStoreProperty:function(e){return this.store[e]},setLivewireProperty:function(e,r,t){this.livewireComponent.set(e,this.cloneValue(r),t)},setStoreProperty:function(e,r){this.store[e]=this.cloneValue(r)},cloneValue:function(e){return void 0!==e?JSON.parse(JSON.stringify(e)):e},valuesAreEqual:function(e,r){return JSON.stringify(e)===JSON.stringify(r)},valuesAreNotEqual:function(e,r){return!this.valuesAreEqual(e,r)},registerSpruceWatcher:function(e,r,t){var i=this;Spruce.watch(this.storeName+"."+e,function(e){i.valuesAreEqual(e,i.getLivewireProperty(r))||i.setLivewireProperty(r,e,t)})},registerLivewireWatcher:function(e,r){var t=this;this.livewireComponent.watch(e,function(e){t.valuesAreEqual(e,t.getStoreProperty(r))||t.setStoreProperty(r,e)})}},r={start:function(){console.log("start"),this.attach()},attach:function(){var e=this;this.checkDependencies(),window.Alpine.addMagicProperty("sprucewire",function(r){return console.log("Sprucewire"),e.getElEntangle(r)}),window.Alpine.addMagicProperty("entangleProperty",function(e){return function(e,r){return void 0===r&&(r=!1),{isDeferred:r,livewireEntangle:e,get defer(){return this.isDeferred=!0,this}}}})},checkDependencies:function(){if(!window.Alpine)throw new Error("[Sprucewire] Alpine must be running.");if(!window.Spruce)throw new Error("[Sprucewire] Spruce must be running.");return!0},getElEntangle:function(r){return Object.assign({},e,{alpineEl:r})},registerStore:function(e,r,t){this.getElEntangle(e).registerStore(r,t)}};window.Sprucewire=r;var t=window.deferLoadingAlpine||function(e){e()};window.deferLoadingAlpine=function(e){window.Sprucewire.start(),t(e)};
//# sourceMappingURL=sprucewire.module.js.map
