var e={alpineEl:null,livewireComponent:null,storeName:null,store:null,registerStore:function(e,t){var r=this;this.ensureStoreMissing(e),this.createStore(e,t),this.findLivewireComponent(),this.livewireComponentNotLoaded()||Object.entries(t).forEach(function(e){var t=e[0],n=e[1];if(!r.isNotEntangleObject(n)){var i=n.livewireEntangle,o=n.isDeferred;r.valuesAreNotEqual(r.getStoreProperty(t),r.getLivewireProperty(i))&&r.setStoreProperty(t,r.getLivewireProperty(i)),r.registerSpruceWatcher(t,i,o),r.registerLivewireWatcher(i,t)}})},loadStore:function(e,t){var r=this;this.ensureStoreExists(e),this.findStore(e),this.findLivewireComponent(),this.livewireComponentNotLoaded()||Object.entries(t).forEach(function(e){var t=e[0],n=e[1];if(!r.isNotEntangleObject(n)){r.ensureStorePropertyExists(t);var i=n.livewireEntangle,o=n.isDeferred;r.valuesAreNotEqual(r.getStoreProperty(t),r.getLivewireProperty(i))&&r.setLivewireProperty(i,r.getStoreProperty(t),o),r.registerSpruceWatcher(t,i,o),r.registerLivewireWatcher(i,t)}})},ensureStoreMissing:function(e){if(Spruce.store(e))throw new Error('[Spruce Entangle] Spruce store "'+e+'" is already registered. Use loadStore.')},ensureStoreExists:function(e){if(!Spruce.store(e))throw new Error('[Spruce Entangle] Spruce store "'+e+'" is not registered. Use registerStore.')},createStore:function(e,t){this.store=Spruce.store(e,this.clearEntangleValues(t)),this.storeName=e},clearEntangleValues:function(e){var t=this;return Object.keys(e).reduce(function(r,n){return r[n]=t.isEntangleObject(e[n])?null:e[n],r},{})},findStore:function(e){this.store=Spruce.store(e),this.storeName=e},findLivewireComponent:function(){var e=this.alpineEl.closest("[wire\\:id]");e&&e.__livewire&&(this.livewireComponent=e.__livewire)},livewireComponentNotLoaded:function(){return!this.livewireComponent},isEntangleObject:function(e){return e&&"object"==typeof e&&e.livewireEntangle},isNotEntangleObject:function(e){return!this.isEntangleObject(e)},ensureStorePropertyExists:function(e){if(!this.store[e])throw new Error('[Spruce Entangle] Spruce store "'+this.storeName+'" does not have property "'+e+'".')},getLivewireProperty:function(e){return this.livewireComponent.getPropertyValueIncludingDefers(e)},getStoreProperty:function(e){return this.store[e]},setLivewireProperty:function(e,t,r){this.livewireComponent.set(e,this.cloneValue(t),r)},setStoreProperty:function(e,t){this.store[e]=this.cloneValue(t)},cloneValue:function(e){return void 0!==e?JSON.parse(JSON.stringify(e)):e},valuesAreEqual:function(e,t){return JSON.stringify(e)===JSON.stringify(t)},valuesAreNotEqual:function(e,t){return!this.valuesAreEqual(e,t)},registerSpruceWatcher:function(e,t,r){var n=this;Spruce.watch(this.storeName+"."+e,function(e){n.valuesAreEqual(e,n.getLivewireProperty(t))||n.setLivewireProperty(t,e,r)})},registerLivewireWatcher:function(e,t){var r=this;this.livewireComponent.watch(e,function(e){r.valuesAreEqual(e,r.getStoreProperty(t))||r.setStoreProperty(t,e)})}},t={start:function(){console.log("start"),this.attach()},attach:function(){var e=this;this.checkDependencies(),window.Alpine.addMagicProperty("spruceEntangle",function(t){return console.log("Spruce Entangle"),e.getElEntangle(t)}),window.Alpine.addMagicProperty("entangleProperty",function(e){return function(e,t){return void 0===t&&(t=!1),{isDeferred:t,livewireEntangle:e,get defer(){return this.isDeferred=!0,this}}}})},checkDependencies:function(){if(!window.Alpine)throw new Error("[Spruce Entangle] Alpine must be running.");if(!window.Spruce)throw new Error("[Spruce Entangle] Spruce must be running.");return!0},getElEntangle:function(t){return Object.assign({},e,{alpineEl:t})},registerStore:function(e,t,r){this.getElEntangle(e).registerStore(t,r)}};window.SpruceEntangle=t;var r=window.deferLoadingAlpine||function(e){e()};window.deferLoadingAlpine=function(e){window.SpruceEntangle.start(),r(e)};
//# sourceMappingURL=spruce-entangle.js.map
